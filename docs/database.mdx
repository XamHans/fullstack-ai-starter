---
title: "Database Architecture"
description: "Database design using Drizzle ORM with PostgreSQL for type-safe, performant data access"
---

# Database Architecture

## What

A type-safe database layer built with Drizzle ORM and PostgreSQL, featuring modular schema design, automatic migrations, and serverless optimization for Neon databases.

## Why

- **Type Safety**: Full TypeScript integration with compile-time validation
- **Performance**: Optimized queries and connection pooling for serverless environments
- **Maintainability**: Modular schema design with domain-separated tables
- **Developer Experience**: SQL-like syntax with auto-completion and IntelliSense

## How

### Setup and Configuration

1. **Install Dependencies**
```bash
npm install drizzle-orm @neondatabase/serverless
npm install -D drizzle-kit
```

2. **Environment Configuration**
```env
DATABASE_URL=postgres://username:password@ep-instance-id.region.aws.neon.tech/neondb
```

3. **Database Connection**
```typescript
// lib/db/index.ts
import { drizzle } from 'drizzle-orm/neon-http';
import { neon } from '@neondatabase/serverless';

if (!process.env.DATABASE_URL) {
  throw new Error('DATABASE_URL is required');
}

const sql = neon(process.env.DATABASE_URL);
export const db = drizzle(sql);
```

### Schema Organization

Each module defines its own schema, then all schemas are combined:

```typescript
// modules/users/schema.ts
export const users = pgTable("users", {
  id: text("id").primaryKey(),
  email: text("email").notNull().unique(),
  name: text("name"),
  createdAt: timestamp("created_at").defaultNow(),
});

// lib/db/schema.ts
export * from "@/modules/users/schema";
export * from "@/modules/posts/schema";
// ... other modules
```

## Example

Complete database setup for a posts feature:

### 1. Define Schema
```typescript
// modules/posts/schema.ts
import { pgTable, text, timestamp, boolean } from "drizzle-orm/pg-core";

export const posts = pgTable("posts", {
  id: text("id").primaryKey().$defaultFn(() => crypto.randomUUID()),
  title: text("title").notNull(),
  content: text("content").notNull(),
  authorId: text("author_id").notNull(),
  published: boolean("published").default(false),
  createdAt: timestamp("created_at").defaultNow(),
  updatedAt: timestamp("updated_at").defaultNow(),
});
```

### 2. Use in Service
```typescript
// modules/posts/services/post.service.ts
import { eq, desc } from "drizzle-orm";
import { posts } from "../schema";

export class PostService {
  constructor(private deps: ServiceDependencies) {}

  async createPost(data: { title: string; content: string }, authorId: string) {
    const [post] = await this.deps.db
      .insert(posts)
      .values({ ...data, authorId })
      .returning();
    return post;
  }

  async getPublishedPosts() {
    return await this.deps.db
      .select()
      .from(posts)
      .where(eq(posts.published, true))
      .orderBy(desc(posts.createdAt));
  }
}
```

### 3. Migration Setup
```typescript
// drizzle.config.ts
import type { Config } from "drizzle-kit";

export default {
  schema: "./lib/db/schema.ts",
  out: "./lib/db/migrations",
  driver: "pg",
  dbCredentials: {
    connectionString: process.env.DATABASE_URL!,
  },
} satisfies Config;
```

## Key Features

- **Modular Schema**: Each business domain manages its own database tables
- **Type Generation**: Automatic TypeScript types from schema definitions
- **Migration Management**: Version-controlled database changes
- **Serverless Optimized**: Efficient connection handling for serverless environments